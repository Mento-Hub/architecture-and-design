@startuml
actor User
participant "Frontend" as FE
participant "API Gateway" as API
participant "Auth Middleware" as MW
participant "Cache" as Cache
participant "Role Service" as RS
participant "Protected\nEndpoint" as PE

User -> FE: Request protected resource
FE -> API: GET /api/protected-resource\nHeaders: {Authorization: Bearer token}

API -> MW: Check authorization
MW -> MW: Extract JWT token
MW -> Cache: Get user roles from cache

alt Roles in cache
    Cache --> MW: User roles
else Roles not in cache
    MW -> RS: Get user roles
    RS --> MW: User roles
    MW -> Cache: Store roles
end

MW -> MW: Check if role allowed\nfor endpoint

alt Authorized
    MW --> API: Continue request
    API -> PE: Process request
    PE --> API: Response data
    API --> FE: 200 OK {data}
else Unauthorized
    MW --> API: Reject request
    API --> FE: 403 Forbidden
    FE -> FE: Redirect to landing page
end
@enduml
